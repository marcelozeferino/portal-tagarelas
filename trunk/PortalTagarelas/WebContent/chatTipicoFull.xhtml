<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core">


<h:head>
<link rel="stylesheet" type="text/css" href="css/tagarelas.css" />
<style type="text/css">
		body {
			padding:0;
			margin:0;
		}
	</style>
	
	<link rel="stylesheet" type="text/css" href="css/posicoes.css"/>
	
<script language="JAVASCRIPT" >
	
	var comecou = false;
	var tempoIni = 0;
	var caracter = 0;
	var texto = "";
	var shift = false;
	
	
	
function enviaMensagem(){
	if (!comecou){
		return;
	}
	
	comecou = false;
	var tempoFim = new Date;
	var tm;
	tm = (tempoFim - tempoIni)/1000;
	tempoIni = 0;
	
	document.getElementById("chatList").innerHTML = "";
	document.getElementById("chatList").innerHTML = "tempo de escrita: " + tm + " segundos";
	formChat.caixaMensagens.value = "";
	formChat.msgTempoTotal.value = tm;
	formChat.msgTempo.value = "";

} 

function clickLink(){
	alert("esta no alerta");
	
}
function VerificaKeypress(e){
	if(window.event) { // IE
		keynum = e.keyCode;
		
	}else if(e.which) { // Netscape/Firefox/Opera
		keynum = e.which;
		
	}
	
	caracter = String.fromCharCode(keynum);
	
	
	if (caracter == " "){
		caracter = String.fromCharCode(183);
	}
	ExibePagina();
}

function formataHora(h){
	var horas = h.getHours();
	var minutos = h.getMinutes();
	var segundos = h.getSeconds();
	var milisegundos = h.getMilliseconds();
	var hf;
	
	
	hf = horas + ":" + minutos + ":" + segundos + ":" + milisegundos;
	return hf;

}

function VerificaKeyDown(e){
	var keynum;
	
	if(window.event) { // IE
		keynum = e.keyCode;
	}else if(e.which) { // Netscape/Firefox/Opera
		keynum = e.which;
	}
	if (keynum == 13){
		enviaMensagem();
		return false;
	}

	if (keynum == 16){
		shift = true;
	}

	texto = document.formChat.caixaMensagens.value.replace(/ /gi, String.fromCharCode(183));
		
			
	if (keynum == 8) {
		caracter = "BACKSPACE";
	}else if (keynum == 36) {
		caracter = "HOME";
	}else if (keynum == 45) {
		caracter = "INSERT";
	}else if (keynum == 46) {
		caracter = "DELETE";
	}else if (keynum == 35) {
		caracter = "END";
	}else if (keynum == 39) {
		caracter = "SETA DIR";
	}else if (keynum == 37) {
		caracter = "SETA ESQ";
	}else if (keynum == 222) {
		if (shift) {
			caracter = "^";
		}else{
			caracter = "~";
		}
	}else if (keynum == 219) {
		if (shift) {
			caracter = "`";
		}else {
			caracter = "´";
		}
	}


	var hora = new Date;
				if (tempoIni == 0){
					tempoIni = hora;
				}

				horaF = formataHora(hora);

				if (caracter != ""){
					ExibePagina();
				}
				
				

}

function VerificaKeyUp(e){
	var keynum;
	if(window.event) { // IE
		keynum = e.keyCode;
	}else if(e.which) { // Netscape/Firefox/Opera
		keynum = e.which;
	}
	if (keynum == 16 ) shift = false;
}



function ExibePagina(){
	
	if (!comecou){
		
		document.getElementById("chatList").innerHTML = "";
		formChat.msgTempoTotal.value = "";
		document.formChat.msgTempo.value = "";
		formChat.msgTempo.value = "";
		
	}
	
	comecou = true;
	if (shift){
		caracter = "SHIFT + " + caracter;
	}
	
	document.getElementById("chatList").innerHTML +=  texto + ", " + caracter + ", " + horaF;
    document.getElementById("msgTempo").value +=  texto + ", " + caracter + ", " + horaF;
	caracter = "";
	


	document.getElementById("chatList").innerHTML = "";
	document.getElementById("chatList").innerHTML = "tempo de escrita: " + tm + " segundos";
	formChat.msgTempoTotal.value = tm;
	caracter = "";
	
}
</script>
</h:head>

<h:body>
<h:form id="formChat" prependId="false" >
<h:inputHidden id="apelido"   value="#{loginBean.login}" />
<h:inputTextarea id="msgTempo"   value="#{chatBean.msgTempo}" />
<h:inputText id="msgTempoTotal"   value="#{chatBean.msgTempoTotal}" />

<div id="content">
		
		<div id="header">
		Projetando o bate-papo genérico do Portal Tagarelas <span id="sair" style="position: absolute; right: 3px;">
		 <h:commandLink id="fechar"  action="#{chatBean.saiu}">   
		<img src="img/fechar.jpg" border="0" />
		</h:commandLink>
		</span>
		
		</div>
		
		<br clear="all"></br>
		
		<div id="onlineListContainer">
		<ul>
				<ui:repeat var="elemento" value="#{chatBean.listaUsuarios}" varStatus="status">
    			<li><img src="#{elemento.url}" alt='test'  width="30" height="30"/>  
   					 &nbsp;<h:outputText  value="#{elemento.nomeUsuario}"  /></li>
   					 <br/>
  				</ui:repeat>
		</ul>	
		</div>
		
		<div id="chatList" style="display: none;" >
			
		</div>
		<div id="mostra">
			 <h:outputText value="#{salaChatBean.conversa}" escape="false" /> 
		</div>
		<div id="chatSendBox">
			<h:inputText size="60" id="caixaMensagens"  value="#{chatBean.mensagem}"  onkeypress="VerificaKeypress(event)" onkeydown="VerificaKeyDown(event)" onkeyup="VerificaKeyUp(event)" /> 
			
			<!--  <h:commandButton action="#{chatBean.enviarMensagem}"  value="Enviar" onClick="enviaMensagem()" >  -->
			 <h:commandLink id="lnkDeleteUser"  onclick="enviaMensagem()">  
			<h:commandButton action="#{chatBean.enviarMensagem}" value="Enviar"  > 	
				<f:param name="idAgenda" value="#{agendaBean.idAgenda}" />
				<f:param name="idUsuario" value="#{loginBean.usuario.idUsuario}" />
				<f:param name="url" value="#{loginBean.usuario.url}" />
			</h:commandButton>
			</h:commandLink>
			 <!-- <h:commandLink id="lnkDeleteUser" value="delete"  onclick="clickLink()"/>   -->
			 
		</div>
</div>

</h:form>





	



</h:body>
</html>


