<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core">


<h:head>
<link type="text/css" rel="stylesheet" media="all" href="css/style.css" charset="utf-8" /> 
<link type="text/css" rel="stylesheet" media="all" href="css/$.css" charset="utf-8" /> 
<link type="text/css" rel="stylesheet" media="all" href="js/ui/jquery.ui.button.css" charset="utf-8" /> 
	
	<script language="JAVASCRIPT" >
	
	var comecou = false;
	var tempoIni = 0;
	//var tempoFim = 0;
	var caracter = 0;
	var texto = "";
	var shift = false;
	var horaF = "00"
	var tempoFim = 0;
	var flag = true; // definido para a primeria vez
	
	
function clickLink(){
	alert("esta no alerta");
	
}
function VerificaKeypress(e){
	if(window.event) { // IE
		keynum = e.keyCode;
		
	}else if(e.which) { // Netscape/Firefox/Opera
		keynum = e.which;
		
	}
	
	caracter = String.fromCharCode(keynum);
	
	
	if (caracter == " "){
		caracter = String.fromCharCode(183);
	}
	ExibePagina();
}

function ExibePagina(){
	
	if (!comecou){
		
		document.getElementById("chatList").innerHTML = "";
		formChat.msgTempoTotal.value = "";
		document.formChat.msgTempo.value = "";
		formChat.msgTempo.value = "";
		texto = "";
		tempoIni = 0;
		tempoFim = 0;
		//horaF = 0;
		var hora = new Date;
		horaF = formataHora(hora);
		
		
		
	}
	
	comecou = true;
	if (shift){
		caracter = "SHIFT + " + caracter;
	}
	
	//document.getElementById("chatList").innerHTML +=  texto + ", " + caracter + ", " + horaF;
	// alert("estou");
	
	document.formChat.msgTempo.value +=  texto + ", " + caracter + ", " + horaF + "  ";
	

	
	/*
	if(!flag){
		tempoFim = new Date;
		flag = true;
	}
	
	var tm;

	tm = (tempoFim - tempoIni)/1000;
	if(flag){
		tempoIni = 0;	
	}
	*/

	document.getElementById("chatList").innerHTML = "";
	document.getElementById("chatList").innerHTML = "tempo de escrita: " + tm + " segundos";
	//formChat.caixaMensagens.value = "";
	formChat.msgTempoTotal.value = tm;
	
	
	caracter = "";
	
}

function VerificaKeyDown(e){
	var keynum;
//alert("key");
	if(window.event) { // IE
		keynum = e.keyCode;
	}else if(e.which) { // Netscape/Firefox/Opera
		keynum = e.which;
	}
	if (keynum == 13){
		enviaMensagem();
		return false;
	}

	if (keynum == 16){
		shift = true;
	}

	

	
		
		texto = document.formChat.caixaMensagens.value.replace(/ /gi, String.fromCharCode(183));
		
		
		
	if (keynum == 8) {
		caracter = "BACKSPACE";
	}else if (keynum == 36) {
		caracter = "HOME";
	}else if (keynum == 45) {
		caracter = "INSERT";
	}else if (keynum == 46) {
		caracter = "DELETE";
	}else if (keynum == 35) {
		caracter = "END";
	}else if (keynum == 39) {
		caracter = "SETA DIR";
	}else if (keynum == 37) {
		caracter = "SETA ESQ";
	}else if (keynum == 222) {
		if (shift) {
			caracter = "^";
		}else{
			caracter = "~";
		}
	}else if (keynum == 219) {
		if (shift) {
			caracter = "`";
		}else {
			caracter = "´";
		}
	}
	
	
	var hora = new Date;
	
	
	/*
	if(flag){
		tempoIni = new Date;
		flag = false;
	}
	
	
	tempoFim = new Date;
	
	var tm;

	tm = (tempoFim - tempoIni)/1000;
	*/
	
	
	var hora = new Date;
	
	if(flag){
		tempoIni = hora;
		flag = false;
	}
	
	tempoFim = new Date;
	var tm;
	
	
	tm = (tempoFim - tempoIni)/1000;
	//tempoIni = 0;
	//tempoFim = new Date;
	
	formChat.msgTempoTotal.value = tm;
	
	//if (tempoIni == 0){
	//	tempoIni = hora;
	//}

	horaF = formataHora(hora);

	
	//if (caracter != ""){
	//	ExibePagina();
	//}
	
	

}

function formataHora(h){
	var horas = h.getHours();
	var minutos = h.getMinutes();
	var segundos = h.getSeconds();
	var milisegundos = h.getMilliseconds();
	var hf;
	
	
	hf = horas + ":" + minutos + ":" + segundos + ":" + milisegundos;
	return hf;

}


function enviaMensagem(){
	if (!comecou){
		return;
	}
	comecou = false;
	var tempoFim = new Date;
	var tm;
	
	
	tm = (tempoFim - tempoIni)/1000;
	tempoIni = 0;
	tempoFim = 0;

	
	document.getElementById("chatList").innerHTML = "";
	document.getElementById("chatList").innerHTML = "tempo de escrita: " + tm + " segundos";
	formChat.caixaMensagens.value = "";
	formChat.msgTempoTotal.value = tm;
	formChat.msgTempo.value = "";
	horaF = 0;
	flag = true;
	
	//alert("aqui: " + tm);
} 

</script>

<style type="text/css">
		body, html {
			margin: 0px;
			padding: 0px;
			height: 100%;
			width: 100%;
			font-size: 11px;
			font-family: 'Lucida Grande', Verdana, Arial;
		}
		#arrowchat_topo {
			background: #fff url(images/logo_tagarelas.png) no-repeat; 
			/* padding-left: 225px; */
			padding-top: 10px;
			font-family: Calibri;
			font-size: 17px;
			/* color: #FF5324;*/
			color: #000;
			}
		#digitacao {
			vertical-align: top; 
			transition: height 0.2s;
			-webkit-transition: height 0.2s; 
			-moz-transition: height 0.2s; 
		}
		
	</style>
	
	<script type="text/javascript" src="js/jquery-1.9.1.js"></script>
	<script type="text/javascript" src="js/jquery-ui.js"></script> 
	<script type="text/javascript" src="js/jquery.autosize.js"></script>
	<script type="text/javascript" src="js/jquery.emotions.js"></script>
	
	
</h:head>

<h:body>
<h:form id="formChat" prependId="false" >
<h:inputHidden id="apelido"   value="#{loginBean.login}" />
<h:inputHidden id="msgTempo"   value="#{chatBean.msgTempo}" />
<h:inputHidden id="msgTempoTotal"   value="#{chatBean.msgTempoTotal}" />
<div id="arrowchat_sound_player_holder">
</div>

<div id="arrowchat_popout_wrapper">
	
	<div id="arrowchat_topo">
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<strong>Projetando o bate-papo genérico do Portal Tagarelas</strong> 
		<span id="sair" style="position: absolute; right: 6px;">
			<a href="#">
				<img src="images/fechar.jpg" border="0" ></img>
			</a>
		</span>
	</div>
	
	<div id="arrowchat_popout_left">
		<div id="arrowchat_popout_friends">
			
				<div id="arrowchat_userslist_available">
				<!-- <a href="">Link</a>-->
				
				
					<div>
						
						<ui:repeat var="elemento" value="#{chatBean.listaUsuarios}" varStatus="status">
    						<div class="arrowchat_userlist" >
    							<img src="#{elemento.url}"  class="arrowchat_userlist_avatar " width="30" height="30"/>
    							<span class="arrowchat_userscontentname">
    							<strong><h:outputText  value="#{elemento.nomeUsuario}"  /></strong>
    							</span>
    							<span class="arrowchat_userscontentdot arrowchat_available">
    							</span>
    						</div>
							<br/>
  						</ui:repeat>
					</div>
				</div>
				<div id="arrowchat_userslist_busy"></div>
				<div id="arrowchat_userslist_away"></div>
				<div id="arrowchat_userslist_offline"></div>
				
		</div>
	</div>
	<div id="arrowchat_popout_right">
		<div id="janela_chat">
			<div id="arrowchat_sala_conversa" class="arrowchat_popout_convo_wrapper arrowchat_popout_convo_focused">
				<div class="arrowchat_popout_convo" id="mensagens_Chat" > <!--style="height: 888px;">-->
					<!--  <div onmouseover="$(tempo).removeClass('arrowchat_ts');" onmouseout="$(tempo).addClass('arrowchat_ts');" id="arrowchat_message_9" class="arrowchat_chatboxmessage"> -->
						
							 <h:outputText value="#{salaChatBean.conversa}" escape="false" /> 
						
						
					<!-- </div>-->
				</div>
				
			</div>
		</div>
		<div id="arrowchat_digita">
					<div class="arrowchat_popout_input_container">
						<div class="arrowchat_popout_input_wrapper">
							<h:inputTextarea  id="digitacao"  value="#{chatBean.mensagem}" onkeypress="VerificaKeypress(event)" onkeyup="VerificaKeyDown(event)" onKeyDown="VerificaKeyDown(event)" class="arrowchat_popout_convo_input"/> 
							
							<div id="legenda" style="float: left; color: #B7B5B5">status...</div>
							<div id="submit" style="float: right;">
								 <h:commandLink id="lnkDeleteUser"  onclick="enviaMensagem()">  
									<h:commandButton action="#{chatBean.enviarMensagem}" value="Enviar" class="ui-button ui-widget ui-state-default ui-corner-all" > 	
										<f:param name="idAgenda" value="#{agendaBean.idAgenda}" />
										<f:param name="idUsuario" value="#{loginBean.usuario.idUsuario}" />
										<f:param name="url" value="#{loginBean.usuario.url}" />
									</h:commandButton>
								</h:commandLink>
								
							</div>
						</div>
					</div>	
				</div>
	</div>
	
</div>


</h:form>
</h:body>
</html>


